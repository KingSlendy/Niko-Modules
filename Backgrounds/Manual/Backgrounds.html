<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Backgrounds — Keep Talking and Nobody Explodes Module</title>
    <meta name="viewport" content="initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type='text/css' href="css/font.css">
    <script src='js/highlighter.js'></script><script src='js/translator.js'></script>
    <script src='js/ruleseed.js'></script>
    <style>
        p.note {
            font-size: 12pt;
            font-weight: bold;
        }

        .footnotes {
            font-style: italic;
            font-size: 10pt;
        }
    </style>
    <script>
        var options = [];
        var possibilities = [];
        var chosen = [];
        var batteries =
            [
                "D", "AA", "holders with 3 batteries", "holders with 4 batteries"
            ];
        var ports =
            [
                "DVI", "Parallel", "PS/2", "RJ-45", "Serial", "Stereo RCA", "Component Video",
                "Composite Video", "USB", "HDMI", "VGA", "AC", "PCMCIA"
            ];
        var indicators =
            [
                "SND", "CLR", "CAR", "IND", "FRQ", "SIG", "NSA", "MSA", "TRN", "BOB", "FRK"
            ];
        var indicatorColors =
            [
                "Blue", "Gray", "Green", "Magenta", "Orange", "Purple", "Red", "Yellow"
            ];
        var coordX =
            [
                "A", "D", "C", "D", "B", "F", "E", "B", "C", "E"
            ];
        var coordY =
            [
                "C", "B", "E", "D", "F", "E", "B", "C", "D", "A"
            ];
        var ManualTable =
            [
                3, 2, 9, 1, 7, 4,
                7, 9, 8, 8, 2, 3,
                5, 1, 7, 4, 4, 6,
                6, 4, 2, 6, 8, 5,
                5, 1, 5, 3, 9, 9,
                1, 2, 3, 6, 7, 8
            ];
        function setRules(rnd)
        {
            if (rnd.seed != 1)
            {
                rnd.ShuffleFisherYates(coordX);
                rnd.ShuffleFisherYates(coordY);
                rnd.ShuffleFisherYates(ManualTable);
                //Slight manual change that makes more sense for just ruleseed.
                document.getElementById('background-foot-2').innerHTML.replace("Mixing Blue and White will <b>not</b> make Blue.", "Mixing any color with White will <b>not</b> make the original color");
            }
            for (var j = 0; j < coordX.length; j++)
                document.getElementById('background-l-' + j).innerHTML = coordX[j];
            for (var j = 0; j < coordY.length; j++)
                document.getElementById('background-r-' + j).innerHTML = coordY[j];
            for (var j = 0; j < ManualTable.length; j++)
                document.getElementById('background-tbl-' + j).innerHTML = ManualTable[j];
            //Primaries randomization
            var i = rnd.next(0, 2);
            //Create possible options for Possibilities
            AddToOptions(i);
            //Generate all possible rules
            Possibilities();
            //Variable for holding the chosen Possibilty indicies
            var RuleIndicies = []
            //Function for generating the original manual for rule seed 1
            Swap();
            //Choose the rules for the manual
            for (var j = 0; j < 9; j++)
            {
                RuleIndicies.push(rnd.next(0, possibilities.length));
                chosen.push(possibilities[RuleIndicies[j]]);
            }
            //Apply the chosen rules
            for (var j = 0; j < chosen.length; j++)
            {
                var hold = "";
                //Add if to all of the rules
                chosen[j] = "if " + chosen[j];
                //Set the first letter to uppercase
                if (j == 0) hold = chosen[0].substr(0, 1).toUpperCase() + chosen[0].substr(1);
                else hold = "Otherwise, " + chosen[j];
                document.getElementById('background-rule-' + j).innerHTML = hold;
            }
            console.log(chosen);
        }
        function Swap()
        {
            var values = [323, 1485, 393, 1413, 566, 1174, 940, 1306, 555 ];
            var newValues = [0, 370, 1320, 1326, 8, 1039, 1400, 1360, 20];
            for (var i = 0; i < values.length; i++)
            {
                var hold = possibilities[values[i]];
                possibilities[values[i]] = possibilities[newValues[i]];
                possibilities[newValues[i]] = hold;
            }
        }
        function setDefaultRules(rnd)
        {
            setRules(rnd);
        }
        function AddToOptions(i)
        {
            options.push("backing");
            options.push("button");
            options.push("submit button");
            options.push("screen");
            DetermineColors(i);
            for (var j = 0; j < batteries.length; j++)
                options.push(batteries[j]);
            for (var j = 0; j < ports.length; j++)
                options.push(ports[j]);
            for (var j = 0; j < indicators.length; j++)
                options.push(indicators[j]);
            var listSize = 1;
            while (listSize < 4)
            {
                var coloredArray = ["red", i == 0 ? "orange" : "cyan", "yellow", "green", "blue",
                    i == 0 ? "purple" : "magenta", "white", "gray", "black"];
                var orderedArray = [0, 1, 2, 3, 4, 5, 6, 7, 8]
                var intList = [[]];
                var current = -1;
                for (var j = 0; j < orderedArray.length; j++)
                {
                    if (current != -1)
                        intList.push([]);
                    current++;
                    intList[current].push(coloredArray[j]);
                    if (listSize > 1)
                    {
                        var list = orderedArray.slice(j + 1);
                        for (var k = 0; k < list.length; k++)
                        {
                            intList[current].push(" or " + coloredArray[list[k]]);
                            if (listSize > 2)
                            {
                                intList[current].pop();
                                intList[current].push(" " + coloredArray[list[k]]);
                                var list2 = orderedArray.slice(list[k] + 1);
                                for (var l = 0; l < list2.length; l++)
                                {
                                    intList[current].push(" or " + coloredArray[list2[l]]);
                                    current++;
                                    intList.push([]);
                                    intList[current].push(coloredArray[j]);
                                    intList[current].push(" " + coloredArray[list[k]]);
                                }
                                intList.pop();
                                current--;
                            }
                            current++;
                            intList.push([]);
                            intList[current].push(coloredArray[j]);
                        }
                        intList.pop();
                        current--;
                    }
                }
                for (var j = 0; j < intList.length; j++)
                {
                    //Check if options already has the sequences created
                    var check = [false, false, false];
                    var check2 = [false, false, false];
                    for (var k = 0; k < options[4].length; k++)
                    {
                        check[k] = options[4][k] == intList[j][k];
                        check2[k] = options[5][k] == intList[j][k];
                    }
                    if (check.every(x => x == true) || check2.every(x => x == true)) continue;
                    options.push(intList[j]);
                }
                listSize++;
            }
        }
        //Checking the primary colors chosen
        function DetermineColors(i) {
            if (i == 0)
            {
                options.push(["red", " yellow", " or blue"]);
                options.push(["orange", " green", " or purple"]);
                options.push(" mixed with red ");
                options.push(" mixed with yellow ");
            }
            else
            {
                options.push(["red", " green", " or blue"]);
                options.push(["cyan", " yellow", " or magenta"]);
                options.push(" mixed with red ");
                options.push(" mixed with green ");
                document.getElementById('background-foot-0').innerHTML.replace("Yellow", "Green");
                document.getElementById('background-foot-1').innerHTML.replace("Orange, Green, and Purple", "Cyan, Yellow, and Magenta");
                document.getElementById('background-foot-2').innerHTML = "Mixing Red and Green will make Yellow, Blue and Green will make Cyan, and Red and Blue will make Magenta. Mixing any color with White will < b > not</b > make the original color."
            }
            options.push(" mixed with blue ");
        }
        function Possibilities()
        {
            var check = false;
            for (var i = 0; i < options.length; i++)
            {
                if (i < 2)
                {
                    for (var j = 0; j < options.length; j++)
                    {
                        if (options[j].length == 2)
                            options[j] = ("" + options[j]).replace(",", "");
                        if (j == i) continue;
                        if (i < 1 && j < 2) {
                            possibilities.push("the color of the " + options[i] + " matches the color of the " + options[j]);
                            possibilities.push("the color of the " + options[i] + " does not match the color of the " + options[j]);
                        }
                        if (j < 4) continue;
                        if (j < 6)
                        {
                            var word = j == 4 ? "primary color*" : "secondary color**";
                            possibilities.push("the color of the " + options[i] + " is a " + word);
                            possibilities.push("the color of the " + options[i] + " is not a " + word);
                            if (i == 0)
                            {
                                possibilities.push("the button or the backing are a " + word);
                                possibilities.push("only the button is a " + word);
                                possibilities.push("only the backing is a " + word);
                                possibilities.push("the button <b>OR</b> the backing is a " + word);
                                word = j == 4 ? "primary colors*" : "secondary colors**";
                                possibilities.push("the button <b>AND</b> the backing are " + word);
                                possibilities.push("neither the button nor the backing are " + word);
                            }
                            continue;
                        }
                        if (j < 9)
                        {
                            possibilities.push("the " + options[i] + "'s color" + options[j] + "creates the " + (i == 0 ? "button's" : "backing's") + " color***");
                            continue;
                        }
                        if (j < 37)
                            continue;
                        var word = j < 46 ? "is " : "is either ";
                        possibilities.push("the color of the " + options[i] + " " + word + options[j]);
                        possibilities.push("the color of the " + options[i] + " " + word.replace("is", "is not") + options[j]);
                        if (i == 0)
                        {
                            var word2 = "are ";
                            possibilities.push("the button or the backing " + word2 + options[j]);
                            possibilities.push("only the button " + word + options[j]);
                            possibilities.push("only the backing " + word + options[j]);
                            possibilities.push("the button <b>OR</b> the backing " + word2 + options[j]);
                            possibilities.push("the button <b>AND</b> the backing " + word + options[j]);
                            possibilities.push("neither the button nor the backing " + word + options[j]);
                        }
                    }
                }
                if (i < 9) continue;
                if (i == 9)
                {
                    possibilities.push("the submit button contains a digit");
                    possibilities.push("the submit button does not contain a digit");
                    possibilities.push("there are no ports present on the bomb");
                    possibilities.push("there is an empty port plate present on the bomb");
                    possibilities.push("there is one port present on the bomb");
                    possibilities.push("there are more than two ports present on the bomb");
                    possibilities.push("there is more than one port plate present on the bomb");
                    possibilities.push("there are no batteries present on the bomb");
                    possibilities.push("there are an odd amount of batteries present on the bomb");
                    possibilities.push("there are an even amount of batteries present on the bomb");
                    possibilities.push("there are no battery holders present on the bomb");
                    possibilities.push("there is one battery holder present on the bomb");
                    possibilities.push("there is more than one battery holder present on the bomb");
                    possibilities.push("there are no indicators present on the bomb");
                    possibilities.push("there is one indicator present on the bomb");
                    possibilities.push("there is more than one indicator present on the bomb");
                    possibilities.push("there are no lit indicators present on the bomb");
                    possibilities.push("there is one lit indicator present on the bomb");
                    possibilities.push("there is more than one lit indicator present on the bomb");
                    possibilities.push("there are no unlit indicators present on the bomb");
                    possibilities.push("there is one unlit indicator present on the bomb");
                    possibilities.push("there is more than one unlit indicator present on the bomb");
                }
                if (i < 13)
                {
                    possibilities.push("there are no " + options[i] + " batteries present on the bomb");
                    possibilities.push("there is one " + options[i] + " battery present on the bomb");
                    possibilities.push("there is more than one " + options[i] + " battery present on the bomb");
                    possibilities.push("there are no battery holders of type " + options[i] + " present on the bomb");
                    possibilities.push("there is one battery holder of type " + options[i] + " present on the bomb");
                    possibilities.push("there is more than one battery holder of type " + options[i] + " present on the bomb");
                    continue;
                }
                if (i < 26)
                {
                    possibilities.push("the bomb contains a " + options[i] + " port");
                    possibilities.push("the bomb contains more than one " + options[i] + " port");
                    possibilities.push("the bomb contains exactly one " + options[i] + " port");
                    possibilities.push("the bomb does not contain a " + options[i] + " port");
                    continue;
                }
                if (i < 37)
                {
                    possibilities.push("there is a " + options[i] + " indicator present on the bomb");
                    possibilities.push("there is not a " + options[i] + " indicator present on the bomb");
                    possibilities.push("there is a lit " + options[i] + " indicator present on the bomb");
                    possibilities.push("there is not a lit " + options[i] + " indicator present on the bomb");
                    possibilities.push("there is an unlit " + options[i] + " indicator present on the bomb");
                    possibilities.push("there is not an unlit " + options[i] + " indicator present on the bomb");
                    for (var j = 0; j < indicatorColors.length; j++)
                    {
                        if (!check)
                            possibilities.push("there is a " + indicatorColors[j] + " indicator present");
                        possibilities.push("there is a " + indicatorColors[j] + " " + options[i] + " indicator present");
                    }
                    check = true;
                }
            }
        }
    </script>
</head>
<body>
    <div class="section">
        <div class="page page-bg-01">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title translatable">Backgrounds</span>
            </div>
            <div class="page-content">
                <img class="diagram" src="img/Component/Backgrounds.svg">
                <h2 class="translatable">On the Subject of Backgrounds</h2>
                <p class="flavour-text translatable">For once you aren’t only focusing on what’s right in front of you. Make sure you pay attention to what’s going on behind the scenes here. We all know how you feel about exploding.</p>
                <p class="translatable">This module will present you with a colored button, a counter, and a submit button. However, the backing may be a certain color. Based on the color of the backing and the color of the button, press the button until the counter matches a certain number and press submit.</p>
                <h3 class="translatable">Step 1:</h3>
                <p class="translatable">Use the rules in Table B to determine your letter pair, finding the first two conditions that apply, using the first letter from the first rule and the second letter from the second rule.</p>
                <h3 class="translatable">Step 2:</h3>
                <p class="translatable">With the letter pair found in Step 1 and Table A, use the first letter along the left and the second letter along the top to find the number of times to press the button before pressing submit. </p>

                <table style="text-align:center;width:90%;border:none" align="center">
                    <caption class="translatable">TABLE A:</caption>
                    <tbody>
                        <tr>
                            <td style="border:none"></td>
                            <td><b>A</b></td>
                            <td><b>B</b></td>
                            <td><b>C</b></td>
                            <td><b>D</b></td>
                            <td><b>E</b></td>
                            <td><b>F</b></td>
                        </tr>
                        <tr>
                            <td><b>A</b></td>
                            <td><div id="background-tbl-0"></div></td>
                            <td><div id="background-tbl-1"></div></td>
                            <td><div id="background-tbl-2"></div></td>
                            <td><div id="background-tbl-3"></div></td>
                            <td><div id="background-tbl-4"></div></td>
                            <td><div id="background-tbl-5"></div></td>
                        </tr>
                        <tr>
                            <td><b>B</b></td>
                            <td><div id="background-tbl-6"></div></td>
                            <td><div id="background-tbl-7"></div></td>
                            <td><div id="background-tbl-8"></div></td>
                            <td><div id="background-tbl-9"></div></td>
                            <td><div id="background-tbl-10"></div></td>
                            <td><div id="background-tbl-11"></div></td>
                        </tr>
                        <tr>
                            <td><b>C</b></td>
                            <td><div id="background-tbl-12"></div></td>
                            <td><div id="background-tbl-13"></div></td>
                            <td><div id="background-tbl-14"></div></td>
                            <td><div id="background-tbl-15"></div></td>
                            <td><div id="background-tbl-16"></div></td>
                            <td><div id="background-tbl-17"></div></td>
                        </tr>
                        <tr>
                            <td><b>D</b></td>
                            <td><div id="background-tbl-18"></div></td>
                            <td><div id="background-tbl-19"></div></td>
                            <td><div id="background-tbl-20"></div></td>
                            <td><div id="background-tbl-21"></div></td>
                            <td><div id="background-tbl-22"></div></td>
                            <td><div id="background-tbl-23"></div></td>
                        </tr>
                        <tr>
                            <td><b>E</b></td>
                            <td><div id="background-tbl-24"></div></td>
                            <td><div id="background-tbl-25"></div></td>
                            <td><div id="background-tbl-26"></div></td>
                            <td><div id="background-tbl-27"></div></td>
                            <td><div id="background-tbl-28"></div></td>
                            <td><div id="background-tbl-29"></div></td>
                        </tr>
                        <tr>
                            <td><b>F</b></td>
                            <td><div id="background-tbl-30"></div></td>
                            <td><div id="background-tbl-31"></div></td>
                            <td><div id="background-tbl-32"></div></td>
                            <td><div id="background-tbl-33"></div></td>
                            <td><div id="background-tbl-34"></div></td>
                            <td><div id="background-tbl-35"></div></td>
                        </tr>
                    </tbody>
                </table>
                <p class="note translatable">(Please note that if you press the button when the counter reads 9, the counter will reset to 0.)</p>
            </div>
            <div class="page-footer relative-footer">Page 1 of 2</div>
        </div>
        <div class="page page-bg-02">
            <div class="page-header">
                <span class="page-header-doc-title">Keep Talking and Nobody Explodes Mod</span>
                <span class="page-header-section-title translatable">Backgrounds</span>
            </div>
            <div class="page-content">
                <table style="text-align:center;width:90%" align="center">
                    <caption class="translatable">TABLE B: Priority rules</caption>
                    <tbody>
                        <tr>
                            <td class="translatable" style="width:50%"><b>RULE</b></td>
                            <td class="translatable"><b>FIRST LETTER</b></td>
                            <td class="translatable"><b>SECOND LETTER</b></td>
                        </tr>
                        <tr>
                            <td id="background-rule-0" class="translatable">If the color of the backing matches the color of the button</td>
                            <td><div id="background-l-0"></div></td>
                            <td><div id="background-r-0"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-1" class="translatable">Otherwise, if the button <b>OR</b> the backing are black or white</td>
                            <td><div id="background-l-1"></div></td>
                            <td><div id="background-r-1"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-2" class="translatable">Otherwise, if there are no D batteries on the bomb</td>
                            <td><div id="background-l-2"></div></td>
                            <td><div id="background-r-2"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-3" class="translatable">Otherwise, if there are no AA batteries on the bomb</td>
                            <td><div id="background-l-3"></div></td>
                            <td><div id="background-r-3"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-4" class="translatable">Otherwise, if the button <b>AND</b> the backing are primary colors*</td>
                            <td><div id="background-l-4"></div></td>
                            <td><div id="background-r-4"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-5" class="translatable">Otherwise, if the button is a secondary color**</td>
                            <td><div id="background-l-5"></div></td>
                            <td><div id="background-r-5"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-6" class="translatable">Otherwise, if there is an unlit "SND" indicator</td>
                            <td><div id="background-l-6"></div></td>
                            <td><div id="background-r-6"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-7" class="translatable">Otherwise, if there is a Serial Port on the bomb</td>
                            <td><div id="background-l-7"></div></td>
                            <td><div id="background-r-7"></div></td>
                        </tr>
                        <tr>
                            <td id="background-rule-8" class="translatable">Otherwise, if the backing's color mixed with blue creates the Button's Color***</td>
                            <td><div id="background-l-8"></div></td>
                            <td><div id="background-r-8"></div></td>
                        </tr>
                        <tr>
                            <td class="translatable">Otherwise, use this rule (This rule can be used twice)</td>
                            <td><div id="background-l-9"></div></td>
                            <td><div id="background-r-9"></div></td>
                        </tr>
                    </tbody>
                </table>
                <p>
                    <div id="background-foot-0" class="footnotes translatable">*: Primary colors are Red, Yellow, and Blue</div>
                    <div id="background-foot-1" class="footnotes translatable">**: Secondary colors are Orange, Green, and Purple</div>
                    <div id="background-foot-2" class="footnotes translatable">***: Mixing Red and Yellow will make Orange, Blue and Yellow will make Green, and Red and Blue will make Purple. Mixing Blue and White will <b>not</b> make Blue.</div>
                </p>
            </div>
            <div class="page-footer relative-footer translatable">Page 2 of 2</div>
        </div>
    </div>
</body>
</html>
